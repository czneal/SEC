# -*- coding: utf-8 -*-
"""
Created on Tue Apr 23 16:51:16 2019

@author: Asus
"""

import xbrl_file_v2 as xf
from xbrl_chapter import Chapter
import lxml
import re
import os
import pandas as pd
import zipfile
from settings import Settings
import urltools
import json
import tree_operations as to

class Taxonomy(object):
    gaap_link = "http://xbrl.fasb.org/us-gaap/"
    def __init__(self, gaap_id):
        self.gaap_dir = Settings.root_dir() + 'us-gaap/'
        self.gaap_file = 'us-gaap-' + gaap_id + '.zip'
        self.gaap_id = gaap_id
        self.taxonomy = None
    
    def read(self):
        if not self.__download():
            return False
        try:
            xsd = SchemeXSD()
            rep = xf.XBRLFile()
            data = []
            with zipfile.ZipFile(self.gaap_dir + self.gaap_file) as zfile:
                for xsd_filename in [f for f in zfile.namelist() if f.find('/stm/')>=0 and f.endswith('xsd')]:
                    xsd.read(zfile.open(xsd_filename))
                    for row in xsd.asdict():            
                        cal_file = zfile.open(os.path.dirname(xsd_filename) +'/'+ row['cal_filename'])
                        rep.chapters = {}
                        for ch in getchapters(cal_file):
                            cal_file = zfile.open(os.path.dirname(xsd_filename) +'/'+ row['cal_filename'])
                            rep.chapters[ch['role']] = Chapter(ch['role'], ch['id'], 'sta', row['doc'])
                            rep.read_cal(cal_file, rep.chapters)
                            row['structure'] = rep.structure_dumps()
                            data.append(row)
            self.taxonomy = pd.DataFrame(data)
        except:
            return False
        
        return True        
    
    def __download(self):        
        if not os.path.exists(self.gaap_dir):
            os.mkdir(self.gaap_dir)
                
        if not os.path.exists(self.gaap_dir + self.gaap_file):
            if not urltools.fetch_urlfile(self.gaap_link + self.gaap_id[0:4] + '/' 
                                          + self.gaap_file, 
                                          self.gaap_dir + self.gaap_file):
                return False
            
        return True
            
class SchemeXSD(object):
    def __init__(self):
        self.cal_filenames = []
        self.doc = []
        self.roles = []
        
    def read(self, filename):
        self.__init__()
        
        etree = lxml.etree.parse(filename)
        root = etree.getroot()
        
        xlink = root.nsmap['xlink']
        for link in list(root.iter('{*}linkbaseRef')):
            href = link.attrib.get('{%s}href' % xlink)
            role = link.attrib.get('{%s}role' % xlink)            
            if role is None:
                continue
            
            if role.split('/')[-1].lower() == 'calculationLinkbaseRef'.lower():
                self.cal_filenames.append(href)                
                
        doc = root.find('.//xs:documentation', root.nsmap)
        if doc is None:
            return
        ms = re.compile('.* +\- +Statement +\- .*(calculation).*')
        doc = [d.strip() for d in doc.text.strip().split('\n') if ms.match(d)]
        if len(doc) > 0:
            self.doc = doc
            
    def aslist(self):
        return [(f.split('-')[3], f.split('-')[4], f, doc) for (f, doc) in zip(self.cal_filenames, self.doc)]
    
    def asdict(self):
        return [{'sheet':f.split('-')[3], 
                 'type':f.split('-')[4], 
                 'cal_filename':f, 
                 'doc':doc} for (f, doc) in zip(self.cal_filenames, self.doc)]
    
def getchapters(file):
    chapters = []
    try:
        etree = lxml.etree.parse(file)
        root = etree.getroot()
        for c_link in root.iter('{*}calculationLink'):
            role = c_link.attrib.get('{%s}role' % root.nsmap['xlink'])
            if role is not None:
                chapters.append({'role':role, 'id':role.split('/')[-1]})
    except:
        return None
    
    return chapters
        
       
structure = json.loads("""{"CONSOLIDATED BALANCE SHEETS": {"us-gaap:LiabilitiesAndStockholdersEquity": {"name": "us-gaap:LiabilitiesAndStockholdersEquity", "tag": "LiabilitiesAndStockholdersEquity", "source": "us-gaap", "weight": 0.0, "children": {"us-gaap:Liabilities": {"name": "us-gaap:Liabilities", "tag": "Liabilities", "source": "us-gaap", "weight": 1.0, "children": {"us-gaap:DeferredIncomeTaxesAndOtherLiabilitiesNoncurrent": {"name": "us-gaap:DeferredIncomeTaxesAndOtherLiabilitiesNoncurrent", "tag": "DeferredIncomeTaxesAndOtherLiabilitiesNoncurrent", "source": "us-gaap", "weight": 1.0, "children": null}, "us-gaap:AssetRetirementObligationsNoncurrent": {"name": "us-gaap:AssetRetirementObligationsNoncurrent", "tag": "AssetRetirementObligationsNoncurrent", "source": "us-gaap", "weight": 1.0, "children": null}, "us-gaap:LiabilitiesCurrent": {"name": "us-gaap:LiabilitiesCurrent", "tag": "LiabilitiesCurrent", "source": "us-gaap", "weight": 1.0, "children": {"us-gaap:AccruedLiabilitiesAndOtherLiabilities": {"name": "us-gaap:AccruedLiabilitiesAndOtherLiabilities", "tag": "AccruedLiabilitiesAndOtherLiabilities", "source": "us-gaap", "weight": 1.0, "children": null}, "us-gaap:AccountsPayableRelatedPartiesCurrent": {"name": "us-gaap:AccountsPayableRelatedPartiesCurrent", "tag": "AccountsPayableRelatedPartiesCurrent", "source": "us-gaap", "weight": 1.0, "children": null}, "us-gaap:EnergyMarketingContractLiabilitiesCurrent": {"name": "us-gaap:EnergyMarketingContractLiabilitiesCurrent", "tag": "EnergyMarketingContractLiabilitiesCurrent", "source": "us-gaap", "weight": 1.0, "children": null}, "us-gaap:AccountsPayableCurrent": {"name": "us-gaap:AccountsPayableCurrent", "tag": "AccountsPayableCurrent", "source": "us-gaap", "weight": 1.0, "children": null}}}, "us-gaap:LongTermDebt": {"name": "us-gaap:LongTermDebt", "tag": "LongTermDebt", "source": "us-gaap", "weight": 1.0, "children": null}}}, "us-gaap:StockholdersEquity": {"name": "us-gaap:StockholdersEquity", "tag": "StockholdersEquity", "source": "us-gaap", "weight": 1.0, "children": {"us-gaap:PreferredStockValue": {"name": "us-gaap:PreferredStockValue", "tag": "PreferredStockValue", "source": "us-gaap", "weight": 1.0, "children": null}, "us-gaap:RetainedEarningsAccumulatedDeficit": {"name": "us-gaap:RetainedEarningsAccumulatedDeficit", "tag": "RetainedEarningsAccumulatedDeficit", "source": "us-gaap", "weight": 1.0, "children": null}, "us-gaap:CommonStockValue": {"name": "us-gaap:CommonStockValue", "tag": "CommonStockValue", "source": "us-gaap", "weight": 1.0, "children": null}, "us-gaap:AdditionalPaidInCapital": {"name": "us-gaap:AdditionalPaidInCapital", "tag": "AdditionalPaidInCapital", "source": "us-gaap", "weight": 1.0, "children": null}}}}}, "us-gaap:Assets": {"name": "us-gaap:Assets", "tag": "Assets", "source": "us-gaap", "weight": 0.0, "children": {"us-gaap:PropertyPlantAndEquipmentNet": {"name": "us-gaap:PropertyPlantAndEquipmentNet", "tag": "PropertyPlantAndEquipmentNet", "source": "us-gaap", "weight": 1.0, "children": {"us-gaap:AccumulatedDepreciationDepletionAndAmortizationPropertyPlantAndEquipment": {"name": "us-gaap:AccumulatedDepreciationDepletionAndAmortizationPropertyPlantAndEquipment", "tag": "AccumulatedDepreciationDepletionAndAmortizationPropertyPlantAndEquipment", "source": "us-gaap", "weight": -1.0, "children": null}, "us-gaap:PropertyPlantAndEquipmentGross": {"name": "us-gaap:PropertyPlantAndEquipmentGross", "tag": "PropertyPlantAndEquipmentGross", "source": "us-gaap", "weight": 1.0, "children": {"us-gaap:PropertyPlantAndEquipmentOther": {"name": "us-gaap:PropertyPlantAndEquipmentOther", "tag": "PropertyPlantAndEquipmentOther", "source": "us-gaap", "weight": 1.0, "children": null}, "ae:MarketingPropertyAndEquipment": {"name": "ae:MarketingPropertyAndEquipment", "tag": "MarketingPropertyAndEquipment", "source": "ae", "weight": 1.0, "children": null}, "us-gaap:OilAndGasPropertySuccessfulEffortMethodGross": {"name": "us-gaap:OilAndGasPropertySuccessfulEffortMethodGross", "tag": "OilAndGasPropertySuccessfulEffortMethodGross", "source": "us-gaap", "weight": 1.0, "children": null}, "ae:TransportationPropertyAndEquipment": {"name": "ae:TransportationPropertyAndEquipment", "tag": "TransportationPropertyAndEquipment", "source": "ae", "weight": 1.0, "children": null}}}}}, "ae:CashDepositsAndOtherAssetsNoncurrent": {"name": "ae:CashDepositsAndOtherAssetsNoncurrent", "tag": "CashDepositsAndOtherAssetsNoncurrent", "source": "ae", "weight": 1.0, "children": null}, "us-gaap:AssetsCurrent": {"name": "us-gaap:AssetsCurrent", "tag": "AssetsCurrent", "source": "us-gaap", "weight": 1.0, "children": {"us-gaap:CashAndCashEquivalentsAtCarryingValue": {"name": "us-gaap:CashAndCashEquivalentsAtCarryingValue", "tag": "CashAndCashEquivalentsAtCarryingValue", "source": "us-gaap", "weight": 1.0, "children": null}, "us-gaap:EnergyMarketingContractsAssetsCurrent": {"name": "us-gaap:EnergyMarketingContractsAssetsCurrent", "tag": "EnergyMarketingContractsAssetsCurrent", "source": "us-gaap", "weight": 1.0, "children": null}, "us-gaap:AccountsReceivableNetCurrent": {"name": "us-gaap:AccountsReceivableNetCurrent", "tag": "AccountsReceivableNetCurrent", "source": "us-gaap", "weight": 1.0, "children": null}, "us-gaap:EnergyRelatedInventory": {"name": "us-gaap:EnergyRelatedInventory", "tag": "EnergyRelatedInventory", "source": "us-gaap", "weight": 1.0, "children": null}, "us-gaap:IncomeTaxesReceivable": {"name": "us-gaap:IncomeTaxesReceivable", "tag": "IncomeTaxesReceivable", "source": "us-gaap", "weight": 1.0, "children": null}, "us-gaap:PrepaidExpenseCurrent": {"name": "us-gaap:PrepaidExpenseCurrent", "tag": "PrepaidExpenseCurrent", "source": "us-gaap", "weight": 1.0, "children": null}}}, "us-gaap:LongTermInvestments": {"name": "us-gaap:LongTermInvestments", "tag": "LongTermInvestments", "source": "us-gaap", "weight": 1.0, "children": null}}}}, "CONSOLIDATED STATEMENTS OF OPERATIONS": {"us-gaap:EarningsPerShareBasicAndDiluted": {"name": "us-gaap:EarningsPerShareBasicAndDiluted", "tag": "EarningsPerShareBasicAndDiluted", "source": "us-gaap", "weight": 0.0, "children": {"us-gaap:IncomeLossFromContinuingOperationsPerBasicAndDilutedShare": {"name": "us-gaap:IncomeLossFromContinuingOperationsPerBasicAndDilutedShare", "tag": "IncomeLossFromContinuingOperationsPerBasicAndDilutedShare", "source": "us-gaap", "weight": 1.0, "children": null}, "us-gaap:IncomeLossFromDiscontinuedOperationsNetOfTaxPerBasicAndDilutedShare": {"name": "us-gaap:IncomeLossFromDiscontinuedOperationsNetOfTaxPerBasicAndDilutedShare", "tag": "IncomeLossFromDiscontinuedOperationsNetOfTaxPerBasicAndDilutedShare", "source": "us-gaap", "weight": 1.0, "children": null}, "ae:IncomeLossFromEquityInvestmentsPerBasicAndDilutedShare": {"name": "ae:IncomeLossFromEquityInvestmentsPerBasicAndDilutedShare", "tag": "IncomeLossFromEquityInvestmentsPerBasicAndDilutedShare", "source": "ae", "weight": 1.0, "children": null}}}, "us-gaap:NetIncomeLoss": {"name": "us-gaap:NetIncomeLoss", "tag": "NetIncomeLoss", "source": "us-gaap", "weight": 0.0, "children": {"us-gaap:IncomeLossFromDiscontinuedOperationsNetOfTaxAttributableToReportingEntity": {"name": "us-gaap:IncomeLossFromDiscontinuedOperationsNetOfTaxAttributableToReportingEntity", "tag": "IncomeLossFromDiscontinuedOperationsNetOfTaxAttributableToReportingEntity", "source": "us-gaap", "weight": 1.0, "children": null}, "us-gaap:IncomeLossFromContinuingOperations": {"name": "us-gaap:IncomeLossFromContinuingOperations", "tag": "IncomeLossFromContinuingOperations", "source": "us-gaap", "weight": 1.0, "children": {"us-gaap:IncomeLossFromContinuingOperationsBeforeIncomeTaxesMinorityInterestAndIncomeLossFromEquityMethodInvestments": {"name": "us-gaap:IncomeLossFromContinuingOperationsBeforeIncomeTaxesMinorityInterestAndIncomeLossFromEquityMethodInvestments", "tag": "IncomeLossFromContinuingOperationsBeforeIncomeTaxesMinorityInterestAndIncomeLossFromEquityMethodInvestments", "source": "us-gaap", "weight": 1.0, "children": {"us-gaap:InterestExpense": {"name": "us-gaap:InterestExpense", "tag": "InterestExpense", "source": "us-gaap", "weight": -1.0, "children": null}, "us-gaap:InvestmentIncomeInterest": {"name": "us-gaap:InvestmentIncomeInterest", "tag": "InvestmentIncomeInterest", "source": "us-gaap", "weight": 1.0, "children": null}, "us-gaap:OperatingIncomeLoss": {"name": "us-gaap:OperatingIncomeLoss", "tag": "OperatingIncomeLoss", "source": "us-gaap", "weight": 1.0, "children": {"us-gaap:CostsAndExpenses": {"name": "us-gaap:CostsAndExpenses", "tag": "CostsAndExpenses", "source": "us-gaap", "weight": -1.0, "children": {"us-gaap:RefiningAndMarketingCosts": {"name": "us-gaap:RefiningAndMarketingCosts", "tag": "RefiningAndMarketingCosts", "source": "us-gaap", "weight": 1.0, "children": null}, "us-gaap:DepreciationDepletionAndAmortization": {"name": "us-gaap:DepreciationDepletionAndAmortization", "tag": "DepreciationDepletionAndAmortization", "source": "us-gaap", "weight": 1.0, "children": null}, "us-gaap:OilAndGasProductionExpense": {"name": "us-gaap:OilAndGasProductionExpense", "tag": "OilAndGasProductionExpense", "source": "us-gaap", "weight": 1.0, "children": null}, "us-gaap:GainLossOnSaleOfOilAndGasProperty": {"name": "us-gaap:GainLossOnSaleOfOilAndGasProperty", "tag": "GainLossOnSaleOfOilAndGasProperty", "source": "us-gaap", "weight": -1.0, "children": null}, "us-gaap:ShippingHandlingAndTransportationCosts": {"name": "us-gaap:ShippingHandlingAndTransportationCosts", "tag": "ShippingHandlingAndTransportationCosts", "source": "us-gaap", "weight": 1.0, "children": null}, "us-gaap:GeneralAndAdministrativeExpense": {"name": "us-gaap:GeneralAndAdministrativeExpense", "tag": "GeneralAndAdministrativeExpense", "source": "us-gaap", "weight": 1.0, "children": null}, "us-gaap:ImpairmentOfOilAndGasProperties": {"name": "us-gaap:ImpairmentOfOilAndGasProperties", "tag": "ImpairmentOfOilAndGasProperties", "source": "us-gaap", "weight": 1.0, "children": null}}}, "us-gaap:Revenues": {"name": "us-gaap:Revenues", "tag": "Revenues", "source": "us-gaap", "weight": 1.0, "children": {"ae:LiquidChemicalTransportationRevenue": {"name": "ae:LiquidChemicalTransportationRevenue", "tag": "LiquidChemicalTransportationRevenue", "source": "ae", "weight": 1.0, "children": null}, "us-gaap:OilAndGasRevenue": {"name": "us-gaap:OilAndGasRevenue", "tag": "OilAndGasRevenue", "source": "us-gaap", "weight": 1.0, "children": null}, "us-gaap:RefiningAndMarketingRevenue": {"name": "us-gaap:RefiningAndMarketingRevenue", "tag": "RefiningAndMarketingRevenue", "source": "us-gaap", "weight": 1.0, "children": null}}}}}}}, "us-gaap:IncomeTaxExpenseBenefit": {"name": "us-gaap:IncomeTaxExpenseBenefit", "tag": "IncomeTaxExpenseBenefit", "source": "us-gaap", "weight": -1.0, "children": {"us-gaap:CurrentIncomeTaxExpenseBenefit": {"name": "us-gaap:CurrentIncomeTaxExpenseBenefit", "tag": "CurrentIncomeTaxExpenseBenefit", "source": "us-gaap", "weight": 1.0, "children": null}, "us-gaap:DeferredIncomeTaxExpenseBenefit": {"name": "us-gaap:DeferredIncomeTaxExpenseBenefit", "tag": "DeferredIncomeTaxExpenseBenefit", "source": "us-gaap", "weight": 1.0, "children": null}}}}}, "ae:IncomeLossFromEquityMethodInvestmentsNetOfTax": {"name": "ae:IncomeLossFromEquityMethodInvestmentsNetOfTax", "tag": "IncomeLossFromEquityMethodInvestmentsNetOfTax", "source": "ae", "weight": 1.0, "children": null}}}}, "CONSOLIDATED STATEMENTS OF CASH FLOWS": {"us-gaap:CashAndCashEquivalentsPeriodIncreaseDecrease": {"name": "us-gaap:CashAndCashEquivalentsPeriodIncreaseDecrease", "tag": "CashAndCashEquivalentsPeriodIncreaseDecrease", "source": "us-gaap", "weight": 0.0, "children": {"us-gaap:NetCashProvidedByUsedInFinancingActivitiesContinuingOperations": {"name": "us-gaap:NetCashProvidedByUsedInFinancingActivitiesContinuingOperations", "tag": "NetCashProvidedByUsedInFinancingActivitiesContinuingOperations", "source": "us-gaap", "weight": 1.0, "children": {"us-gaap:PaymentsOfDividends": {"name": "us-gaap:PaymentsOfDividends", "tag": "PaymentsOfDividends", "source": "us-gaap", "weight": -1.0, "children": null}}}, "us-gaap:NetCashProvidedByUsedInOperatingActivitiesContinuingOperations": {"name": "us-gaap:NetCashProvidedByUsedInOperatingActivitiesContinuingOperations", "tag": "NetCashProvidedByUsedInOperatingActivitiesContinuingOperations", "source": "us-gaap", "weight": 1.0, "children": {"us-gaap:IncreaseDecreaseInPrepaidExpense": {"name": "us-gaap:IncreaseDecreaseInPrepaidExpense", "tag": "IncreaseDecreaseInPrepaidExpense", "source": "us-gaap", "weight": -1.0, "children": null}, "ae:DeferredIncomeTaxExpenseBenefitIncludingTaxExpenseBenefitFromEquityMethodInvestment": {"name": "ae:DeferredIncomeTaxExpenseBenefitIncludingTaxExpenseBenefitFromEquityMethodInvestment", "tag": "DeferredIncomeTaxExpenseBenefitIncludingTaxExpenseBenefitFromEquityMethodInvestment", "source": "ae", "weight": 1.0, "children": null}, "us-gaap:NetIncomeLoss": {"name": "us-gaap:NetIncomeLoss", "tag": "NetIncomeLoss", "source": "us-gaap", "weight": 1.0, "children": null}, "us-gaap:IncreaseDecreaseInAccruedLiabilities": {"name": "us-gaap:IncreaseDecreaseInAccruedLiabilities", "tag": "IncreaseDecreaseInAccruedLiabilities", "source": "us-gaap", "weight": 1.0, "children": null}, "us-gaap:IncomeLossFromEquityMethodInvestments": {"name": "us-gaap:IncomeLossFromEquityMethodInvestments", "tag": "IncomeLossFromEquityMethodInvestments", "source": "us-gaap", "weight": -1.0, "children": null}, "us-gaap:IncreaseDecreaseInIncomeTaxesReceivable": {"name": "us-gaap:IncreaseDecreaseInIncomeTaxesReceivable", "tag": "IncreaseDecreaseInIncomeTaxesReceivable", "source": "us-gaap", "weight": -1.0, "children": null}, "us-gaap:GainLossOnSaleOfOilAndGasProperty": {"name": "us-gaap:GainLossOnSaleOfOilAndGasProperty", "tag": "GainLossOnSaleOfOilAndGasProperty", "source": "us-gaap", "weight": -1.0, "children": null}, "us-gaap:UnrealizedGainLossOnDerivativesAndCommodityContracts": {"name": "us-gaap:UnrealizedGainLossOnDerivativesAndCommodityContracts", "tag": "UnrealizedGainLossOnDerivativesAndCommodityContracts", "source": "us-gaap", "weight": -1.0, "children": null}, "us-gaap:IncreaseDecreaseInAccountsPayable": {"name": "us-gaap:IncreaseDecreaseInAccountsPayable", "tag": "IncreaseDecreaseInAccountsPayable", "source": "us-gaap", "weight": 1.0, "children": null}, "us-gaap:IncreaseDecreaseInAccountsReceivable": {"name": "us-gaap:IncreaseDecreaseInAccountsReceivable", "tag": "IncreaseDecreaseInAccountsReceivable", "source": "us-gaap", "weight": -1.0, "children": null}, "us-gaap:GainLossOnDispositionOfAssets": {"name": "us-gaap:GainLossOnDispositionOfAssets", "tag": "GainLossOnDispositionOfAssets", "source": "us-gaap", "weight": -1.0, "children": null}, "us-gaap:DepreciationDepletionAndAmortization": {"name": "us-gaap:DepreciationDepletionAndAmortization", "tag": "DepreciationDepletionAndAmortization", "source": "us-gaap", "weight": 1.0, "children": null}, "us-gaap:ProvisionForDoubtfulAccounts": {"name": "us-gaap:ProvisionForDoubtfulAccounts", "tag": "ProvisionForDoubtfulAccounts", "source": "us-gaap", "weight": 1.0, "children": null}, "us-gaap:ResultsOfOperationsDryHoleCosts": {"name": "us-gaap:ResultsOfOperationsDryHoleCosts", "tag": "ResultsOfOperationsDryHoleCosts", "source": "us-gaap", "weight": 1.0, "children": null}, "us-gaap:OtherOperatingActivitiesCashFlowStatement": {"name": "us-gaap:OtherOperatingActivitiesCashFlowStatement", "tag": "OtherOperatingActivitiesCashFlowStatement", "source": "us-gaap", "weight": 1.0, "children": null}, "us-gaap:ImpairmentOfOilAndGasProperties": {"name": "us-gaap:ImpairmentOfOilAndGasProperties", "tag": "ImpairmentOfOilAndGasProperties", "source": "us-gaap", "weight": 1.0, "children": null}, "us-gaap:EquityMethodInvestmentOtherThanTemporaryImpairment": {"name": "us-gaap:EquityMethodInvestmentOtherThanTemporaryImpairment", "tag": "EquityMethodInvestmentOtherThanTemporaryImpairment", "source": "us-gaap", "weight": 1.0, "children": null}, "us-gaap:IncreaseDecreaseInInventories": {"name": "us-gaap:IncreaseDecreaseInInventories", "tag": "IncreaseDecreaseInInventories", "source": "us-gaap", "weight": -1.0, "children": null}}}, "us-gaap:NetCashProvidedByUsedInInvestingActivitiesContinuingOperations": {"name": "us-gaap:NetCashProvidedByUsedInInvestingActivitiesContinuingOperations", "tag": "NetCashProvidedByUsedInInvestingActivitiesContinuingOperations", "source": "us-gaap", "weight": 1.0, "children": {"us-gaap:IncreaseDecreaseInDepositOtherAssets": {"name": "us-gaap:IncreaseDecreaseInDepositOtherAssets", "tag": "IncreaseDecreaseInDepositOtherAssets", "source": "us-gaap", "weight": -1.0, "children": null}, "us-gaap:PaymentsToAcquirePropertyPlantAndEquipment": {"name": "us-gaap:PaymentsToAcquirePropertyPlantAndEquipment", "tag": "PaymentsToAcquirePropertyPlantAndEquipment", "source": "us-gaap", "weight": -1.0, "children": null}, "us-gaap:ProceedsFromSaleOfPropertyPlantAndEquipment": {"name": "us-gaap:ProceedsFromSaleOfPropertyPlantAndEquipment", "tag": "ProceedsFromSaleOfPropertyPlantAndEquipment", "source": "us-gaap", "weight": 1.0, "children": null}, "us-gaap:PaymentsForProceedsFromInvestments": {"name": "us-gaap:PaymentsForProceedsFromInvestments", "tag": "PaymentsForProceedsFromInvestments", "source": "us-gaap", "weight": -1.0, "children": null}}}}}}}""")
structure = json.loads("""{"Consolidated Balance Sheet": {"us-gaap:LiabilitiesAndStockholdersEquity": {"name": "us-gaap:LiabilitiesAndStockholdersEquity", "tag": "LiabilitiesAndStockholdersEquity", "source": "us-gaap", "weight": 0.0, "children": {"us-gaap:Liabilities": {"name": "us-gaap:Liabilities", "tag": "Liabilities", "source": "us-gaap", "weight": 1.0, "children": {"us-gaap:Deposits": {"name": "us-gaap:Deposits", "tag": "Deposits", "source": "us-gaap", "weight": 1.0, "children": {"us-gaap:NoninterestBearingDepositLiabilities": {"name": "us-gaap:NoninterestBearingDepositLiabilities", "tag": "NoninterestBearingDepositLiabilities", "source": "us-gaap", "weight": 1.0, "children": null}, "us-gaap:InterestBearingDepositLiabilities": {"name": "us-gaap:InterestBearingDepositLiabilities", "tag": "InterestBearingDepositLiabilities", "source": "us-gaap", "weight": 1.0, "children": null}}}, "us-gaap:ShortTermBorrowings": {"name": "us-gaap:ShortTermBorrowings", "tag": "ShortTermBorrowings", "source": "us-gaap", "weight": 1.0, "children": null}, "us-gaap:AccountsPayableAndAccruedLiabilitiesCurrentAndNoncurrent": {"name": "us-gaap:AccountsPayableAndAccruedLiabilitiesCurrentAndNoncurrent", "tag": "AccountsPayableAndAccruedLiabilitiesCurrentAndNoncurrent", "source": "us-gaap", "weight": 1.0, "children": null}, "us-gaap:LongTermDebt": {"name": "us-gaap:LongTermDebt", "tag": "LongTermDebt", "source": "us-gaap", "weight": 1.0, "children": null}}}, "us-gaap:StockholdersEquityIncludingPortionAttributableToNoncontrollingInterest": {"name": "us-gaap:StockholdersEquityIncludingPortionAttributableToNoncontrollingInterest", "tag": "StockholdersEquityIncludingPortionAttributableToNoncontrollingInterest", "source": "us-gaap", "weight": 1.0, "children": {"us-gaap:StockholdersEquity": {"name": "us-gaap:StockholdersEquity", "tag": "StockholdersEquity", "source": "us-gaap", "weight": 1.0, "children": {"us-gaap:PreferredStockValue": {"name": "us-gaap:PreferredStockValue", "tag": "PreferredStockValue", "source": "us-gaap", "weight": 1.0, "children": null}, "us-gaap:CommonStockValue": {"name": "us-gaap:CommonStockValue", "tag": "CommonStockValue", "source": "us-gaap", "weight": 1.0, "children": null}, "us-gaap:AdditionalPaidInCapital": {"name": "us-gaap:AdditionalPaidInCapital", "tag": "AdditionalPaidInCapital", "source": "us-gaap", "weight": 1.0, "children": null}, "us-gaap:RetainedEarningsAccumulatedDeficit": {"name": "us-gaap:RetainedEarningsAccumulatedDeficit", "tag": "RetainedEarningsAccumulatedDeficit", "source": "us-gaap", "weight": 1.0, "children": null}, "us-gaap:AccumulatedOtherComprehensiveIncomeLossNetOfTax": {"name": "us-gaap:AccumulatedOtherComprehensiveIncomeLossNetOfTax", "tag": "AccumulatedOtherComprehensiveIncomeLossNetOfTax", "source": "us-gaap", "weight": 1.0, "children": null}, "us-gaap:TreasuryStockValue": {"name": "us-gaap:TreasuryStockValue", "tag": "TreasuryStockValue", "source": "us-gaap", "weight": -1.0, "children": null}, "wfc:UnearnedESOPSharesCost": {"name": "wfc:UnearnedESOPSharesCost", "tag": "UnearnedESOPSharesCost", "source": "wfc", "weight": -1.0, "children": null}}}, "us-gaap:MinorityInterest": {"name": "us-gaap:MinorityInterest", "tag": "MinorityInterest", "source": "us-gaap", "weight": 1.0, "children": null}}}}}, "us-gaap:Assets": {"name": "us-gaap:Assets", "tag": "Assets", "source": "us-gaap", "weight": 0.0, "children": {"us-gaap:CashAndDueFromBanks": {"name": "us-gaap:CashAndDueFromBanks", "tag": "CashAndDueFromBanks", "source": "us-gaap", "weight": 1.0, "children": null}, "wfc:FederalFundsSoldSecuritiesPurchasedUnderResaleAgreementsAndOtherShortTermInvestments": {"name": "wfc:FederalFundsSoldSecuritiesPurchasedUnderResaleAgreementsAndOtherShortTermInvestments", "tag": "FederalFundsSoldSecuritiesPurchasedUnderResaleAgreementsAndOtherShortTermInvestments", "source": "wfc", "weight": 1.0, "children": null}, "wfc:TradingAssets": {"name": "wfc:TradingAssets", "tag": "TradingAssets", "source": "wfc", "weight": 1.0, "children": null}, "us-gaap:AvailableForSaleSecurities": {"name": "us-gaap:AvailableForSaleSecurities", "tag": "AvailableForSaleSecurities", "source": "us-gaap", "weight": 1.0, "children": null}, "us-gaap:HeldToMaturitySecurities": {"name": "us-gaap:HeldToMaturitySecurities", "tag": "HeldToMaturitySecurities", "source": "us-gaap", "weight": 1.0, "children": null}, "us-gaap:LoansHeldForSaleMortgages": {"name": "us-gaap:LoansHeldForSaleMortgages", "tag": "LoansHeldForSaleMortgages", "source": "us-gaap", "weight": 1.0, "children": null}, "us-gaap:LoansHeldForSaleOther": {"name": "us-gaap:LoansHeldForSaleOther", "tag": "LoansHeldForSaleOther", "source": "us-gaap", "weight": 1.0, "children": null}, "us-gaap:LoansAndLeasesReceivableNetReportedAmount": {"name": "us-gaap:LoansAndLeasesReceivableNetReportedAmount", "tag": "LoansAndLeasesReceivableNetReportedAmount", "source": "us-gaap", "weight": 1.0, "children": {"us-gaap:LoansAndLeasesReceivableNetOfDeferredIncome": {"name": "us-gaap:LoansAndLeasesReceivableNetOfDeferredIncome", "tag": "LoansAndLeasesReceivableNetOfDeferredIncome", "source": "us-gaap", "weight": 1.0, "children": null}, "us-gaap:LoansAndLeasesReceivableAllowance": {"name": "us-gaap:LoansAndLeasesReceivableAllowance", "tag": "LoansAndLeasesReceivableAllowance", "source": "us-gaap", "weight": -1.0, "children": null}}}, "us-gaap:ServicingAssetAtFairValueAmount": {"name": "us-gaap:ServicingAssetAtFairValueAmount", "tag": "ServicingAssetAtFairValueAmount", "source": "us-gaap", "weight": 1.0, "children": null}, "us-gaap:ServicingAssetAtAmortizedValue": {"name": "us-gaap:ServicingAssetAtAmortizedValue", "tag": "ServicingAssetAtAmortizedValue", "source": "us-gaap", "weight": 1.0, "children": null}, "us-gaap:PropertyPlantAndEquipmentNet": {"name": "us-gaap:PropertyPlantAndEquipmentNet", "tag": "PropertyPlantAndEquipmentNet", "source": "us-gaap", "weight": 1.0, "children": null}, "us-gaap:Goodwill": {"name": "us-gaap:Goodwill", "tag": "Goodwill", "source": "us-gaap", "weight": 1.0, "children": null}, "us-gaap:OtherAssets": {"name": "us-gaap:OtherAssets", "tag": "OtherAssets", "source": "us-gaap", "weight": 1.0, "children": null}}}}, "Consolidated Statement of Cash Flows": {"us-gaap:CashAndCashEquivalentsPeriodIncreaseDecrease": {"name": "us-gaap:CashAndCashEquivalentsPeriodIncreaseDecrease", "tag": "CashAndCashEquivalentsPeriodIncreaseDecrease", "source": "us-gaap", "weight": 0.0, "children": {"us-gaap:NetCashProvidedByUsedInOperatingActivitiesContinuingOperations": {"name": "us-gaap:NetCashProvidedByUsedInOperatingActivitiesContinuingOperations", "tag": "NetCashProvidedByUsedInOperatingActivitiesContinuingOperations", "source": "us-gaap", "weight": 1.0, "children": {"us-gaap:IncomeLossFromContinuingOperationsIncludingPortionAttributableToNoncontrollingInterest": {"name": "us-gaap:IncomeLossFromContinuingOperationsIncludingPortionAttributableToNoncontrollingInterest", "tag": "IncomeLossFromContinuingOperationsIncludingPortionAttributableToNoncontrollingInterest", "source": "us-gaap", "weight": 1.0, "children": null}, "us-gaap:ProvisionForLoanLeaseAndOtherLosses": {"name": "us-gaap:ProvisionForLoanLeaseAndOtherLosses", "tag": "ProvisionForLoanLeaseAndOtherLosses", "source": "us-gaap", "weight": 1.0, "children": null}, "wfc:UnrealizedGainLossOnMortgageServicingRightsMortgagesHeldForSaleAndLoansHeldForSale": {"name": "wfc:UnrealizedGainLossOnMortgageServicingRightsMortgagesHeldForSaleAndLoansHeldForSale", "tag": "UnrealizedGainLossOnMortgageServicingRightsMortgagesHeldForSaleAndLoansHeldForSale", "source": "wfc", "weight": -1.0, "children": null}, "us-gaap:DepreciationAmortizationAndAccretionNet": {"name": "us-gaap:DepreciationAmortizationAndAccretionNet", "tag": "DepreciationAmortizationAndAccretionNet", "source": "us-gaap", "weight": 1.0, "children": null}, "us-gaap:OtherNoncashIncomeExpense": {"name": "us-gaap:OtherNoncashIncomeExpense", "tag": "OtherNoncashIncomeExpense", "source": "us-gaap", "weight": -1.0, "children": null}, "wfc:ShareBasedCompensationAndPreferredStockReleasedByEmployeeStockOptionPlan": {"name": "wfc:ShareBasedCompensationAndPreferredStockReleasedByEmployeeStockOptionPlan", "tag": "ShareBasedCompensationAndPreferredStockReleasedByEmployeeStockOptionPlan", "source": "wfc", "weight": 1.0, "children": null}, "us-gaap:ExcessTaxBenefitFromShareBasedCompensationOperatingActivities": {"name": "us-gaap:ExcessTaxBenefitFromShareBasedCompensationOperatingActivities", "tag": "ExcessTaxBenefitFromShareBasedCompensationOperatingActivities", "source": "us-gaap", "weight": -1.0, "children": null}, "us-gaap:PaymentsForOriginationOfMortgageLoansHeldForSale": {"name": "us-gaap:PaymentsForOriginationOfMortgageLoansHeldForSale", "tag": "PaymentsForOriginationOfMortgageLoansHeldForSale", "source": "us-gaap", "weight": -1.0, "children": null}, "wfc:ProceedsFromSalesOfAndPrincipalCollectedOnMortgagesOriginatedForSale": {"name": "wfc:ProceedsFromSalesOfAndPrincipalCollectedOnMortgagesOriginatedForSale", "tag": "ProceedsFromSalesOfAndPrincipalCollectedOnMortgagesOriginatedForSale", "source": "wfc", "weight": 1.0, "children": null}, "wfc:PaymentsForOriginationOfLoansHeldForSale": {"name": "wfc:PaymentsForOriginationOfLoansHeldForSale", "tag": "PaymentsForOriginationOfLoansHeldForSale", "source": "wfc", "weight": -1.0, "children": null}, "wfc:ProceedsFromSalesOfAndPrincipalCollectedOnLoansHeldForSale": {"name": "wfc:ProceedsFromSalesOfAndPrincipalCollectedOnLoansHeldForSale", "tag": "ProceedsFromSalesOfAndPrincipalCollectedOnLoansHeldForSale", "source": "wfc", "weight": 1.0, "children": null}, "us-gaap:PaymentsToPurchaseOtherLoansHeldForSale": {"name": "us-gaap:PaymentsToPurchaseOtherLoansHeldForSale", "tag": "PaymentsToPurchaseOtherLoansHeldForSale", "source": "us-gaap", "weight": -1.0, "children": null}, "wfc:IncreaseDecreaseInTradingAssets": {"name": "wfc:IncreaseDecreaseInTradingAssets", "tag": "IncreaseDecreaseInTradingAssets", "source": "wfc", "weight": 1.0, "children": null}, "us-gaap:IncreaseDecreaseInDeferredIncomeTaxes": {"name": "us-gaap:IncreaseDecreaseInDeferredIncomeTaxes", "tag": "IncreaseDecreaseInDeferredIncomeTaxes", "source": "us-gaap", "weight": -1.0, "children": null}, "us-gaap:IncreaseDecreaseInAccruedInterestReceivableNet": {"name": "us-gaap:IncreaseDecreaseInAccruedInterestReceivableNet", "tag": "IncreaseDecreaseInAccruedInterestReceivableNet", "source": "us-gaap", "weight": -1.0, "children": null}, "us-gaap:IncreaseDecreaseInInterestPayableNet": {"name": "us-gaap:IncreaseDecreaseInInterestPayableNet", "tag": "IncreaseDecreaseInInterestPayableNet", "source": "us-gaap", "weight": 1.0, "children": null}, "us-gaap:IncreaseDecreaseInOtherOperatingAssets": {"name": "us-gaap:IncreaseDecreaseInOtherOperatingAssets", "tag": "IncreaseDecreaseInOtherOperatingAssets", "source": "us-gaap", "weight": -1.0, "children": null}, "us-gaap:IncreaseDecreaseInOtherAccountsPayableAndAccruedLiabilities": {"name": "us-gaap:IncreaseDecreaseInOtherAccountsPayableAndAccruedLiabilities", "tag": "IncreaseDecreaseInOtherAccountsPayableAndAccruedLiabilities", "source": "us-gaap", "weight": 1.0, "children": null}}}, "us-gaap:NetCashProvidedByUsedInInvestingActivitiesContinuingOperations": {"name": "us-gaap:NetCashProvidedByUsedInInvestingActivitiesContinuingOperations", "tag": "NetCashProvidedByUsedInInvestingActivitiesContinuingOperations", "source": "us-gaap", "weight": 1.0, "children": {"wfc:NetChangeInFederalFundsSoldSecuritiesPurchasedUnderResaleAgreementsAndOtherShortTermInvestments": {"name": "wfc:NetChangeInFederalFundsSoldSecuritiesPurchasedUnderResaleAgreementsAndOtherShortTermInvestments", "tag": "NetChangeInFederalFundsSoldSecuritiesPurchasedUnderResaleAgreementsAndOtherShortTermInvestments", "source": "wfc", "weight": -1.0, "children": null}, "us-gaap:ProceedsFromSaleOfAvailableForSaleSecurities": {"name": "us-gaap:ProceedsFromSaleOfAvailableForSaleSecurities", "tag": "ProceedsFromSaleOfAvailableForSaleSecurities", "source": "us-gaap", "weight": 1.0, "children": null}, "us-gaap:ProceedsFromMaturitiesPrepaymentsAndCallsOfAvailableForSaleSecurities": {"name": "us-gaap:ProceedsFromMaturitiesPrepaymentsAndCallsOfAvailableForSaleSecurities", "tag": "ProceedsFromMaturitiesPrepaymentsAndCallsOfAvailableForSaleSecurities", "source": "us-gaap", "weight": 1.0, "children": null}, "us-gaap:PaymentsToAcquireAvailableForSaleSecurities": {"name": "us-gaap:PaymentsToAcquireAvailableForSaleSecurities", "tag": "PaymentsToAcquireAvailableForSaleSecurities", "source": "us-gaap", "weight": -1.0, "children": null}, "us-gaap:ProceedsFromMaturitiesPrepaymentsAndCallsOfHeldToMaturitySecurities": {"name": "us-gaap:ProceedsFromMaturitiesPrepaymentsAndCallsOfHeldToMaturitySecurities", "tag": "ProceedsFromMaturitiesPrepaymentsAndCallsOfHeldToMaturitySecurities", "source": "us-gaap", "weight": 1.0, "children": null}, "us-gaap:PaymentsToAcquireHeldToMaturitySecurities": {"name": "us-gaap:PaymentsToAcquireHeldToMaturitySecurities", "tag": "PaymentsToAcquireHeldToMaturitySecurities", "source": "us-gaap", "weight": -1.0, "children": null}, "wfc:ProceedsFromSaleOfNonmarketableEquityInvestments": {"name": "wfc:ProceedsFromSaleOfNonmarketableEquityInvestments", "tag": "ProceedsFromSaleOfNonmarketableEquityInvestments", "source": "wfc", "weight": 1.0, "children": null}, "wfc:PaymentsToAcquireNonmarketableEquityInvestments": {"name": "wfc:PaymentsToAcquireNonmarketableEquityInvestments", "tag": "PaymentsToAcquireNonmarketableEquityInvestments", "source": "wfc", "weight": -1.0, "children": null}, "wfc:PaymentsForLoansOriginatedByBankingSubsidiariesNetOfProceedsFromCollections": {"name": "wfc:PaymentsForLoansOriginatedByBankingSubsidiariesNetOfProceedsFromCollections", "tag": "PaymentsForLoansOriginatedByBankingSubsidiariesNetOfProceedsFromCollections", "source": "wfc", "weight": -1.0, "children": null}, "us-gaap:ProceedsFromSaleOfLoansAndLeasesHeldForInvestment": {"name": "us-gaap:ProceedsFromSaleOfLoansAndLeasesHeldForInvestment", "tag": "ProceedsFromSaleOfLoansAndLeasesHeldForInvestment", "source": "us-gaap", "weight": 1.0, "children": null}, "us-gaap:PaymentsToAcquireLoansAndLeasesHeldForInvestment": {"name": "us-gaap:PaymentsToAcquireLoansAndLeasesHeldForInvestment", "tag": "PaymentsToAcquireLoansAndLeasesHeldForInvestment", "source": "us-gaap", "weight": -1.0, "children": null}, "wfc:PrincipalCollectedOnNonbankEntitiesLoans": {"name": "wfc:PrincipalCollectedOnNonbankEntitiesLoans", "tag": "PrincipalCollectedOnNonbankEntitiesLoans", "source": "wfc", "weight": 1.0, "children": null}, "wfc:LoansOriginatedByNonbankEntities": {"name": "wfc:LoansOriginatedByNonbankEntities", "tag": "LoansOriginatedByNonbankEntities", "source": "wfc", "weight": -1.0, "children": null}, "us-gaap:PaymentsToAcquireBusinessesNetOfCashAcquired": {"name": "us-gaap:PaymentsToAcquireBusinessesNetOfCashAcquired", "tag": "PaymentsToAcquireBusinessesNetOfCashAcquired", "source": "us-gaap", "weight": -1.0, "children": null}, "wfc:ProceedsFromSaleOfForeclosedAssetsAndShortSales": {"name": "wfc:ProceedsFromSaleOfForeclosedAssetsAndShortSales", "tag": "ProceedsFromSaleOfForeclosedAssetsAndShortSales", "source": "wfc", "weight": 1.0, "children": null}, "us-gaap:PaymentsForProceedsFromMortgageServicingRights": {"name": "us-gaap:PaymentsForProceedsFromMortgageServicingRights", "tag": "PaymentsForProceedsFromMortgageServicingRights", "source": "us-gaap", "weight": -1.0, "children": null}, "us-gaap:PaymentsForProceedsFromOtherInvestingActivities": {"name": "us-gaap:PaymentsForProceedsFromOtherInvestingActivities", "tag": "PaymentsForProceedsFromOtherInvestingActivities", "source": "us-gaap", "weight": -1.0, "children": null}}}, "us-gaap:NetCashProvidedByUsedInFinancingActivitiesContinuingOperations": {"name": "us-gaap:NetCashProvidedByUsedInFinancingActivitiesContinuingOperations", "tag": "NetCashProvidedByUsedInFinancingActivitiesContinuingOperations", "source": "us-gaap", "weight": 1.0, "children": {"us-gaap:IncreaseDecreaseInDeposits": {"name": "us-gaap:IncreaseDecreaseInDeposits", "tag": "IncreaseDecreaseInDeposits", "source": "us-gaap", "weight": 1.0, "children": null}, "us-gaap:ProceedsFromRepaymentsOfShortTermDebt": {"name": "us-gaap:ProceedsFromRepaymentsOfShortTermDebt", "tag": "ProceedsFromRepaymentsOfShortTermDebt", "source": "us-gaap", "weight": 1.0, "children": null}, "us-gaap:ProceedsFromIssuanceOfLongTermDebtAndCapitalSecuritiesNet": {"name": "us-gaap:ProceedsFromIssuanceOfLongTermDebtAndCapitalSecuritiesNet", "tag": "ProceedsFromIssuanceOfLongTermDebtAndCapitalSecuritiesNet", "source": "us-gaap", "weight": 1.0, "children": null}, "us-gaap:RepaymentsOfLongTermDebt": {"name": "us-gaap:RepaymentsOfLongTermDebt", "tag": "RepaymentsOfLongTermDebt", "source": "us-gaap", "weight": -1.0, "children": null}, "us-gaap:ProceedsFromIssuanceOfPreferredStockAndPreferenceStock": {"name": "us-gaap:ProceedsFromIssuanceOfPreferredStockAndPreferenceStock", "tag": "ProceedsFromIssuanceOfPreferredStockAndPreferenceStock", "source": "us-gaap", "weight": 1.0, "children": null}, "us-gaap:PaymentsOfDividendsPreferredStockAndPreferenceStock": {"name": "us-gaap:PaymentsOfDividendsPreferredStockAndPreferenceStock", "tag": "PaymentsOfDividendsPreferredStockAndPreferenceStock", "source": "us-gaap", "weight": -1.0, "children": null}, "us-gaap:ProceedsFromIssuanceOfCommonStock": {"name": "us-gaap:ProceedsFromIssuanceOfCommonStock", "tag": "ProceedsFromIssuanceOfCommonStock", "source": "us-gaap", "weight": 1.0, "children": null}, "us-gaap:PaymentsForRepurchaseOfCommonStock": {"name": "us-gaap:PaymentsForRepurchaseOfCommonStock", "tag": "PaymentsForRepurchaseOfCommonStock", "source": "us-gaap", "weight": -1.0, "children": null}, "us-gaap:PaymentsOfDividendsCommonStock": {"name": "us-gaap:PaymentsOfDividendsCommonStock", "tag": "PaymentsOfDividendsCommonStock", "source": "us-gaap", "weight": -1.0, "children": null}, "us-gaap:PaymentsForRepurchaseOfWarrants": {"name": "us-gaap:PaymentsForRepurchaseOfWarrants", "tag": "PaymentsForRepurchaseOfWarrants", "source": "us-gaap", "weight": -1.0, "children": null}, "us-gaap:ExcessTaxBenefitFromShareBasedCompensationFinancingActivities": {"name": "us-gaap:ExcessTaxBenefitFromShareBasedCompensationFinancingActivities", "tag": "ExcessTaxBenefitFromShareBasedCompensationFinancingActivities", "source": "us-gaap", "weight": 1.0, "children": null}, "us-gaap:ProceedsFromPaymentsToMinorityShareholders": {"name": "us-gaap:ProceedsFromPaymentsToMinorityShareholders", "tag": "ProceedsFromPaymentsToMinorityShareholders", "source": "us-gaap", "weight": 1.0, "children": null}, "us-gaap:ProceedsFromPaymentsForOtherFinancingActivities": {"name": "us-gaap:ProceedsFromPaymentsForOtherFinancingActivities", "tag": "ProceedsFromPaymentsForOtherFinancingActivities", "source": "us-gaap", "weight": 1.0, "children": null}}}}}}, "Consolidated Statement of Comprehensive Income": {"us-gaap:ComprehensiveIncomeNetOfTax": {"name": "us-gaap:ComprehensiveIncomeNetOfTax", "tag": "ComprehensiveIncomeNetOfTax", "source": "us-gaap", "weight": 0.0, "children": {"us-gaap:ComprehensiveIncomeNetOfTaxAttributableToNoncontrollingInterest": {"name": "us-gaap:ComprehensiveIncomeNetOfTaxAttributableToNoncontrollingInterest", "tag": "ComprehensiveIncomeNetOfTaxAttributableToNoncontrollingInterest", "source": "us-gaap", "weight": -1.0, "children": null}, "us-gaap:ComprehensiveIncomeNetOfTaxIncludingPortionAttributableToNoncontrollingInterest": {"name": "us-gaap:ComprehensiveIncomeNetOfTaxIncludingPortionAttributableToNoncontrollingInterest", "tag": "ComprehensiveIncomeNetOfTaxIncludingPortionAttributableToNoncontrollingInterest", "source": "us-gaap", "weight": 1.0, "children": null}}}}, "Consolidated Statement of Income": {"us-gaap:NetIncomeLossAvailableToCommonStockholdersBasic": {"name": "us-gaap:NetIncomeLossAvailableToCommonStockholdersBasic", "tag": "NetIncomeLossAvailableToCommonStockholdersBasic", "source": "us-gaap", "weight": 0.0, "children": {"us-gaap:NetIncomeLoss": {"name": "us-gaap:NetIncomeLoss", "tag": "NetIncomeLoss", "source": "us-gaap", "weight": 1.0, "children": {"us-gaap:IncomeLossFromContinuingOperationsIncludingPortionAttributableToNoncontrollingInterest": {"name": "us-gaap:IncomeLossFromContinuingOperationsIncludingPortionAttributableToNoncontrollingInterest", "tag": "IncomeLossFromContinuingOperationsIncludingPortionAttributableToNoncontrollingInterest", "source": "us-gaap", "weight": 1.0, "children": {"us-gaap:IncomeLossFromContinuingOperationsBeforeIncomeTaxesExtraordinaryItemsNoncontrollingInterest": {"name": "us-gaap:IncomeLossFromContinuingOperationsBeforeIncomeTaxesExtraordinaryItemsNoncontrollingInterest", "tag": "IncomeLossFromContinuingOperationsBeforeIncomeTaxesExtraordinaryItemsNoncontrollingInterest", "source": "us-gaap", "weight": 1.0, "children": {"us-gaap:InterestIncomeExpenseAfterProvisionForLoanLoss": {"name": "us-gaap:InterestIncomeExpenseAfterProvisionForLoanLoss", "tag": "InterestIncomeExpenseAfterProvisionForLoanLoss", "source": "us-gaap", "weight": 1.0, "children": {"us-gaap:InterestIncomeExpenseNet": {"name": "us-gaap:InterestIncomeExpenseNet", "tag": "InterestIncomeExpenseNet", "source": "us-gaap", "weight": 1.0, "children": {"us-gaap:InterestAndDividendIncomeOperating": {"name": "us-gaap:InterestAndDividendIncomeOperating", "tag": "InterestAndDividendIncomeOperating", "source": "us-gaap", "weight": 1.0, "children": {"us-gaap:InterestAndDividendIncomeSecuritiesTradingOrMeasuredAtFairValue": {"name": "us-gaap:InterestAndDividendIncomeSecuritiesTradingOrMeasuredAtFairValue", "tag": "InterestAndDividendIncomeSecuritiesTradingOrMeasuredAtFairValue", "source": "us-gaap", "weight": 1.0, "children": null}, "us-gaap:InterestAndDividendIncomeSecurities": {"name": "us-gaap:InterestAndDividendIncomeSecurities", "tag": "InterestAndDividendIncomeSecurities", "source": "us-gaap", "weight": 1.0, "children": null}, "us-gaap:InterestAndFeeIncomeLoansHeldForSaleMortgages": {"name": "us-gaap:InterestAndFeeIncomeLoansHeldForSaleMortgages", "tag": "InterestAndFeeIncomeLoansHeldForSaleMortgages", "source": "us-gaap", "weight": 1.0, "children": null}, "us-gaap:InterestAndFeeIncomeNonmortgageLoansAndLeasesHeldForSale": {"name": "us-gaap:InterestAndFeeIncomeNonmortgageLoansAndLeasesHeldForSale", "tag": "InterestAndFeeIncomeNonmortgageLoansAndLeasesHeldForSale", "source": "us-gaap", "weight": 1.0, "children": null}, "us-gaap:InterestAndFeeIncomeLoansAndLeasesHeldInPortfolio": {"name": "us-gaap:InterestAndFeeIncomeLoansAndLeasesHeldInPortfolio", "tag": "InterestAndFeeIncomeLoansAndLeasesHeldInPortfolio", "source": "us-gaap", "weight": 1.0, "children": null}, "us-gaap:OtherInterestAndDividendIncome": {"name": "us-gaap:OtherInterestAndDividendIncome", "tag": "OtherInterestAndDividendIncome", "source": "us-gaap", "weight": 1.0, "children": null}}}, "us-gaap:InterestExpense": {"name": "us-gaap:InterestExpense", "tag": "InterestExpense", "source": "us-gaap", "weight": -1.0, "children": {"us-gaap:InterestExpenseDeposits": {"name": "us-gaap:InterestExpenseDeposits", "tag": "InterestExpenseDeposits", "source": "us-gaap", "weight": 1.0, "children": null}, "us-gaap:InterestExpenseShortTermBorrowings": {"name": "us-gaap:InterestExpenseShortTermBorrowings", "tag": "InterestExpenseShortTermBorrowings", "source": "us-gaap", "weight": 1.0, "children": null}, "us-gaap:InterestExpenseLongTermDebt": {"name": "us-gaap:InterestExpenseLongTermDebt", "tag": "InterestExpenseLongTermDebt", "source": "us-gaap", "weight": 1.0, "children": null}, "us-gaap:InterestExpenseOther": {"name": "us-gaap:InterestExpenseOther", "tag": "InterestExpenseOther", "source": "us-gaap", "weight": 1.0, "children": null}}}}}, "us-gaap:ProvisionForLoanLeaseAndOtherLosses": {"name": "us-gaap:ProvisionForLoanLeaseAndOtherLosses", "tag": "ProvisionForLoanLeaseAndOtherLosses", "source": "us-gaap", "weight": -1.0, "children": null}}}, "us-gaap:NoninterestIncome": {"name": "us-gaap:NoninterestIncome", "tag": "NoninterestIncome", "source": "us-gaap", "weight": 1.0, "children": {"wfc:FeesAndCommissionsDepositorsAccounts": {"name": "wfc:FeesAndCommissionsDepositorsAccounts", "tag": "FeesAndCommissionsDepositorsAccounts", "source": "wfc", "weight": 1.0, "children": null}, "us-gaap:FeesAndCommissionsFiduciaryAndTrustActivities": {"name": "us-gaap:FeesAndCommissionsFiduciaryAndTrustActivities", "tag": "FeesAndCommissionsFiduciaryAndTrustActivities", "source": "us-gaap", "weight": 1.0, "children": null}, "us-gaap:FeesAndCommissionsCreditAndDebitCards": {"name": "us-gaap:FeesAndCommissionsCreditAndDebitCards", "tag": "FeesAndCommissionsCreditAndDebitCards", "source": "us-gaap", "weight": 1.0, "children": null}, "us-gaap:FeesAndCommissionsOther": {"name": "us-gaap:FeesAndCommissionsOther", "tag": "FeesAndCommissionsOther", "source": "us-gaap", "weight": 1.0, "children": null}, "wfc:FeesAndCommissionMortgageBanking": {"name": "wfc:FeesAndCommissionMortgageBanking", "tag": "FeesAndCommissionMortgageBanking", "source": "wfc", "weight": 1.0, "children": null}, "us-gaap:InsuranceServicesRevenue": {"name": "us-gaap:InsuranceServicesRevenue", "tag": "InsuranceServicesRevenue", "source": "us-gaap", "weight": 1.0, "children": null}, "us-gaap:TradingGainsLosses": {"name": "us-gaap:TradingGainsLosses", "tag": "TradingGainsLosses", "source": "us-gaap", "weight": 1.0, "children": null}, "us-gaap:GainLossOnSaleOfDebtInvestments": {"name": "us-gaap:GainLossOnSaleOfDebtInvestments", "tag": "GainLossOnSaleOfDebtInvestments", "source": "us-gaap", "weight": 1.0, "children": null}, "wfc:NetGainsLossesFromEquityInvestments": {"name": "wfc:NetGainsLossesFromEquityInvestments", "tag": "NetGainsLossesFromEquityInvestments", "source": "wfc", "weight": 1.0, "children": null}, "us-gaap:OperatingLeasesIncomeStatementLeaseRevenue": {"name": "us-gaap:OperatingLeasesIncomeStatementLeaseRevenue", "tag": "OperatingLeasesIncomeStatementLeaseRevenue", "source": "us-gaap", "weight": 1.0, "children": null}, "us-gaap:NoninterestIncomeOtherOperatingIncome": {"name": "us-gaap:NoninterestIncomeOtherOperatingIncome", "tag": "NoninterestIncomeOtherOperatingIncome", "source": "us-gaap", "weight": 1.0, "children": null}}}, "us-gaap:NoninterestExpense": {"name": "us-gaap:NoninterestExpense", "tag": "NoninterestExpense", "source": "us-gaap", "weight": -1.0, "children": {"us-gaap:SalariesWagesAndOfficersCompensation": {"name": "us-gaap:SalariesWagesAndOfficersCompensation", "tag": "SalariesWagesAndOfficersCompensation", "source": "us-gaap", "weight": 1.0, "children": null}, "wfc:CommissionAndIncentiveCompensation": {"name": "wfc:CommissionAndIncentiveCompensation", "tag": "CommissionAndIncentiveCompensation", "source": "wfc", "weight": 1.0, "children": null}, "us-gaap:OtherLaborRelatedExpenses": {"name": "us-gaap:OtherLaborRelatedExpenses", "tag": "OtherLaborRelatedExpenses", "source": "us-gaap", "weight": 1.0, "children": null}, "us-gaap:EquipmentExpense": {"name": "us-gaap:EquipmentExpense", "tag": "EquipmentExpense", "source": "us-gaap", "weight": 1.0, "children": null}, "us-gaap:OccupancyNet": {"name": "us-gaap:OccupancyNet", "tag": "OccupancyNet", "source": "us-gaap", "weight": 1.0, "children": null}, "us-gaap:AmortizationOfIntangibleAssets": {"name": "us-gaap:AmortizationOfIntangibleAssets", "tag": "AmortizationOfIntangibleAssets", "source": "us-gaap", "weight": 1.0, "children": null}, "us-gaap:FederalDepositInsuranceCorporationPremiumExpense": {"name": "us-gaap:FederalDepositInsuranceCorporationPremiumExpense", "tag": "FederalDepositInsuranceCorporationPremiumExpense", "source": "us-gaap", "weight": 1.0, "children": null}, "us-gaap:OtherNoninterestExpense": {"name": "us-gaap:OtherNoninterestExpense", "tag": "OtherNoninterestExpense", "source": "us-gaap", "weight": 1.0, "children": null}}}}}, "us-gaap:IncomeTaxExpenseBenefit": {"name": "us-gaap:IncomeTaxExpenseBenefit", "tag": "IncomeTaxExpenseBenefit", "source": "us-gaap", "weight": -1.0, "children": null}}}, "us-gaap:NetIncomeLossAttributableToNoncontrollingInterest": {"name": "us-gaap:NetIncomeLossAttributableToNoncontrollingInterest", "tag": "NetIncomeLossAttributableToNoncontrollingInterest", "source": "us-gaap", "weight": -1.0, "children": null}}}, "us-gaap:PreferredStockDividendsAndOtherAdjustments": {"name": "us-gaap:PreferredStockDividendsAndOtherAdjustments", "tag": "PreferredStockDividendsAndOtherAdjustments", "source": "us-gaap", "weight": -1.0, "children": null}}}}}""")
tx = Taxonomy('2013-01-31')
tx.read()

for _,_,_, bs in to.enumerate_chapter_tags(structure, chap_id='bs'):
    tags = set([c for (p,c,_,_) in to.enumerate_tags_basic(bs) if c.startswith('us-gaap')])
    tags.update([p for (p,c,_,_) in to.enumerate_tags_basic(bs) if c.startswith('us-gaap')])
    
tax_bs = tx.taxonomy
tax_bs = tax_bs[tax_bs['sheet']=='sfp']
for index, row in tax_bs.iterrows():
    tax_tags = set([c for (p,c,_,_) in to.enumerate_tags_basic(json.loads(row['structure']))])
    tax_tags.update([p for (p,c,_,_) in to.enumerate_tags_basic(json.loads(row['structure']))])
    print(row['type'], len(tags.difference(tax_tags)))
    print(tags.difference(tax_tags))